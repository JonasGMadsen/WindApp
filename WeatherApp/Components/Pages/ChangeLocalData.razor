@page "/change-local-data"
@inject IWebHostEnvironment WebHostEnvironment
@inject NavigationManager NavigationManager


<h3>Change Local Wind Data</h3>

<InputFile OnChange="HandleFileSelected" />

<p>@statusMessage</p>

@code {
    private string statusMessage = string.Empty;

    private async Task HandleFileSelected(InputFileChangeEventArgs e)
    {
        var file = e.File;
        if (file == null)
        {
            statusMessage = "No file selected.";
            return;
        }

        var filePath = Path.Combine(WebHostEnvironment.WebRootPath, "data", "winddata.json");
        try
        {
            await using var stream = file.OpenReadStream(maxAllowedSize: 50 * 1024 * 1024); // 50 MB file limit. Files should at most be around 10-30 MB, this is just in case
            await using var fileStream = new FileStream(filePath, FileMode.Create);
            await stream.CopyToAsync(fileStream);

            statusMessage = "Wind data file updated successfully.";
            StateHasChanged();

            await Task.Delay(2000); // a small delay for user feedback
            NavigationManager.NavigateTo("/");
        }
        catch (Exception ex)
        {
            statusMessage = $"Error updating file: {ex.Message}";
            StateHasChanged(); 
        }
    }
}